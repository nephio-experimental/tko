# https://ansible.readthedocs.io/projects/builder/en/stable/
# https://github.com/ansible/awx-ee/blob/devel/execution-environment.yml

version: 3

dependencies:
  ansible_core:
    package_pip: ansible-core==$ANSIBLE_CORE_VERSION
  ansible_runner:
    package_pip: ansible-runner==$ANSIBLE_BUILDER_VERSION
  python:
  - ruamel.yaml
  - grpcio-tools

images:
  base_image:
    name: docker.io/alpine:$ALPINE_VERSION

additional_build_files:
- src: ../../sdk/python
  dest: python # relative to "_build"

additional_build_steps:
  prepend_base: |
    RUN apk add --no-cache bash python3 py3-pip gcc musl-dev
    COPY _build/python/tko /usr/lib/python3.12/tko

options:
  package_manager_path: apk

build_arg_defaults:
  PKGMGR_PRESERVE_CACHE: always # "clean" is not supported by apk
